<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quran Digital - Auto Play Terjemahan</title>
    <!-- Optimized CSS - Inline untuk mengurangi HTTP requests -->
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Segoe UI',system-ui,sans-serif;background:linear-gradient(135deg,#1a5e1a,#0d3315);color:#333;min-height:100vh;padding:10px}
        .container{max-width:900px;margin:0 auto;background:rgba(255,255,255,0.98);border-radius:15px;box-shadow:0 8px 25px rgba(0,0,0,0.2);overflow:hidden}
        .header{background:linear-gradient(135deg,#2d7d2d,#1a5e1a);color:white;padding:20px;text-align:center}
        .header h1{font-size:1.8em;margin-bottom:8px;text-shadow:1px 1px 3px rgba(0,0,0,0.3)}
        .controls{background:#e8f5e8;padding:15px;display:flex;gap:10px;flex-wrap:wrap;justify-content:center;border-bottom:2px solid #2d7d2d}
        .surah-selector,.playback-controls{display:flex;gap:8px;align-items:center}
        select,button{padding:10px 15px;border:none;border-radius:6px;font-size:0.95em;cursor:pointer;transition:all 0.2s ease}
        select{background:white;border:2px solid #2d7d2d;min-width:180px}
        button{background:#2d7d2d;color:white;font-weight:600}
        button:hover{background:#1a5e1a;transform:translateY(-1px)}
        button:disabled{background:#cccccc;cursor:not-allowed;transform:none}
        .status{background:#f8fff8;padding:12px;text-align:center;border-bottom:2px solid #e0e0e0;font-weight:600;color:#2d7d2d;font-size:0.9em}
        .quran-text{padding:20px;direction:rtl;max-height:60vh;overflow-y:auto}
        .verse{margin-bottom:20px;padding:15px;border-radius:12px;background:#f8fff8;border:2px solid transparent;transition:all 0.2s ease;box-shadow:0 3px 10px rgba(0,0,0,0.08)}
        .verse.active{border-color:#2d7d2d;background:#e8f5e8;transform:translateY(-3px);box-shadow:0 5px 15px rgba(45,125,45,0.15)}
        .verse.playing-translation{border-color:#ff6b00;background:#fff8f0}
        .arabic{font-size:1.8em;line-height:1.6;text-align:center;color:#1a3a1a;margin-bottom:10px;font-family:'Traditional Arabic','Scheherazade',serif}
        .translation{font-size:1em;line-height:1.5;text-align:center;color:#444;padding:10px;background:white;border-radius:6px;border-left:3px solid #2d7d2d}
        .verse-number{display:inline-block;background:#2d7d2d;color:white;width:28px;height:28px;border-radius:50%;text-align:center;line-height:28px;font-size:0.8em;margin-left:6px}
        .audio-indicator{display:inline-block;margin-left:8px;font-size:0.75em;padding:2px 6px;border-radius:3px;background:#2d7d2d;color:white}
        .translation-indicator{background:#ff6b00}
        .footer{text-align:center;padding:15px;background:#1a5e1a;color:white;font-size:0.85em}
        .loading{text-align:center;padding:15px;color:#2d7d2d;font-size:1em}
        @media (max-width:768px){.container{margin:5px;border-radius:12px}.controls{flex-direction:column}.arabic{font-size:1.5em}.translation{font-size:0.9em}select{min-width:150px}}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Quran Digital Auto-Play</h1>
            <p>Ayat + Terjemahan Otomatis</p>
        </div>
        
        <div class="controls">
            <div class="surah-selector">
                <select id="surahSelect">
                    <option value="1">Surah Al-Fatihah (1)</option>
                    <option value="2">Surah Al-Baqarah (2)</option>
                    <option value="114">Surah An-Nas (114)</option>
                </select>
                <button id="loadSurahBtn">Muat Surah</button>
            </div>
            
            <div class="playback-controls">
                <button id="playBtn">▶ Mulai Auto-Play</button>
                <button id="pauseBtn" disabled>⏸ Jeda</button>
                <button id="stopBtn" disabled>⏹ Berhenti</button>
            </div>
        </div>
        
        <div class="status" id="statusText">
            Pilih surah dan klik "Mulai Auto-Play"
        </div>
        
        <div class="quran-text" id="quranText">
            <div class="loading">Pilih surah untuk memulai...</div>
        </div>
        
        <div class="footer">
            <p>Quran Digital &copy; 2024 • Terjemahan Kemenag RI</p>
        </div>
    </div>

    <!-- Optimized JavaScript - Minimal dan efisien -->
    <script>
        // Data surah yang lebih ringkas
        const surahs = {
            "1": {
                name: "Al-Fatihah",
                verses: [
                    {arabic: "بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ", translation: "Dengan nama Allah Yang Maha Pengasih, Maha Penyayang."},
                    {arabic: "الْحَمْدُ لِلَّهِ رَبِّ الْعَالَمِينَ", translation: "Segala puji bagi Allah, Tuhan seluruh alam,"},
                    {arabic: "الرَّحْمَٰنِ الرَّحِيمِ", translation: "Yang Maha Pengasih, Maha Penyayang,"},
                    {arabic: "مَالِكِ يَوْمِ الدِّينِ", translation: "Pemilik hari pembalasan."},
                    {arabic: "إِيَّاكَ نَعْبُدُ وَإِيَّاكَ نَسْتَعِينُ", translation: "Hanya kepada Engkaulah kami menyembah dan hanya kepada Engkaulah kami mohon pertolongan."},
                    {arabic: "اهْدِنَا الصِّرَاطَ الْمُسْتَقِيمَ", translation: "Tunjukilah kami jalan yang lurus,"},
                    {arabic: "صِرَاطَ الَّذِينَ أَنْعَمْتَ عَلَيْهِمْ غَيْرِ الْمَغْضُوبِ عَلَيْهِمْ وَلَا الضَّالِّينَ", translation: "(yaitu) jalan orang-orang yang telah Engkau beri nikmat kepadanya; bukan (jalan) mereka yang dimurkai, dan bukan (pula jalan) mereka yang sesat."}
                ]
            },
            "2": {
                name: "Al-Baqarah", 
                verses: [
                    {arabic: "الم", translation: "Alif Lam Mim."},
                    {arabic: "ذَٰلِكَ الْكِتَابُ لَا رَيْبَ ۛ فِيهِ ۛ هُدًى لِلْمُتَّقِينَ", translation: "Kitab (Al-Qur'an) ini tidak ada keraguan padanya; petunjuk bagi mereka yang bertakwa,"},
                    {arabic: "الَّذِينَ يُؤْمِنُونَ بِالْغَيْبِ وَيُقِيمُونَ الصَّلَاةَ وَمِمَّا رَزَقْنَاهُمْ يُنْفِقُونَ", translation: "(yaitu) mereka yang beriman kepada yang gaib, melaksanakan salat, dan menginfakkan sebagian rezeki yang Kami berikan kepada mereka."}
                ]
            },
            "114": {
                name: "An-Nas",
                verses: [
                    {arabic: "قُلْ أَعُوذُ بِرَبِّ النَّاسِ", translation: "Katakanlah, Aku berlindung kepada Tuhan manusia,"},
                    {arabic: "مَلِكِ النَّاسِ", translation: "Raja manusia,"},
                    {arabic: "إِلَٰهِ النَّاسِ", translation: "Sembahan manusia,"},
                    {arabic: "مِنْ شَرِّ الْوَسْوَاسِ الْخَنَّاسِ", translation: "dari kejahatan (bisikan) setan yang bersembunyi,"},
                    {arabic: "الَّذِي يُوَسْوِسُ فِي صُدُورِ النَّاسِ", translation: "yang membisikkan (kejahatan) ke dalam dada manusia,"},
                    {arabic: "مِنَ الْجِنَّةِ وَالنَّاسِ", translation: "dari (golongan) jin dan manusia."}
                ]
            }
        };

        // Cache DOM elements
        const elements = {
            surahSelect: document.getElementById('surahSelect'),
            loadSurahBtn: document.getElementById('loadSurahBtn'),
            playBtn: document.getElementById('playBtn'),
            pauseBtn: document.getElementById('pauseBtn'),
            stopBtn: document.getElementById('stopBtn'),
            statusText: document.getElementById('statusText'),
            quranText: document.getElementById('quranText')
        };

        // State management
        let state = {
            currentSurah: null,
            currentVerseIndex: 0,
            isPlaying: false,
            isPaused: false,
            audioElement: null,
            synthesis: window.speechSynthesis || null
        };

        // Event delegation untuk performance
        document.addEventListener('click', (e) => {
            const id = e.target.id;
            if (id === 'loadSurahBtn') loadSurah();
            else if (id === 'playBtn') togglePlayback();
            else if (id === 'pauseBtn') pausePlayback();
            else if (id === 'stopBtn') stopPlayback();
        });

        // Optimized functions
        function loadSurah() {
            const surahId = elements.surahSelect.value;
            state.currentSurah = surahs[surahId];
            
            if (!state.currentSurah) {
                elements.statusText.textContent = "Surah tidak ditemukan";
                return;
            }
            
            renderSurah();
            resetPlayback();
            elements.statusText.textContent = `Surah ${state.currentSurah.name} dimuat. ${state.currentSurah.verses.length} ayat tersedia.`;
        }

        function renderSurah() {
            const versesHTML = state.currentSurah.verses.map((verse, index) => `
                <div class="verse" id="verse-${index}">
                    <div class="arabic">${verse.arabic} <span class="verse-number">${index + 1}</span></div>
                    <div class="translation">${verse.translation}</div>
                </div>
            `).join('');
            
            elements.quranText.innerHTML = versesHTML;
        }

        function togglePlayback() {
            if (!state.currentSurah) {
                elements.statusText.textContent = "Pilih surah terlebih dahulu";
                return;
            }
            
            if (state.isPaused) {
                resumePlayback();
            } else {
                startPlayback();
            }
        }

        function startPlayback() {
            resetPlayback();
            state.isPlaying = true;
            state.isPaused = false;
            updateControls();
            playVerse(0);
        }

        function playVerse(index) {
            if (!state.currentSurah || index >= state.currentSurah.verses.length) {
                stopPlayback();
                return;
            }
            
            state.currentVerseIndex = index;
            const verse = state.currentSurah.verses[index];
            
            // Update UI
            updateVerseHighlight();
            elements.statusText.textContent = `Memutar ayat ${index + 1} dari ${state.currentSurah.name}`;
            
            // Scroll ke ayat
            const verseElement = document.getElementById(`verse-${index}`);
            if (verseElement) {
                verseElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            
            // Gunakan Web Speech API untuk kedua audio (simulasi)
            speakText(verse.arabic, 'arabic', () => {
                elements.statusText.textContent = `Memulai terjemahan ayat ${index + 1}`;
                speakText(verse.translation, 'translation', () => {
                    playNextVerse();
                });
            });
        }

        function speakText(text, type, onEnd) {
            if (!state.synthesis) {
                // Fallback jika Web Speech API tidak tersedia
                setTimeout(onEnd, 2000);
                return;
            }
            
            state.synthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = type === 'arabic' ? 'ar-SA' : 'id-ID';
            utterance.rate = 0.8;
            utterance.pitch = 1.0;
            
            // Update UI berdasarkan type
            const verseElement = document.getElementById(`verse-${state.currentVerseIndex}`);
            if (verseElement) {
                if (type === 'arabic') {
                    verseElement.classList.add('active');
                } else {
                    verseElement.classList.add('playing-translation');
                }
            }
            
            utterance.onend = () => {
                if (verseElement) {
                    if (type === 'arabic') {
                        verseElement.classList.remove('active');
                    } else {
                        verseElement.classList.remove('playing-translation');
                    }
                }
                onEnd();
            };
            
            state.synthesis.speak(utterance);
        }

        function playNextVerse() {
            const nextIndex = state.currentVerseIndex + 1;
            if (nextIndex < state.currentSurah.verses.length) {
                playVerse(nextIndex);
            } else {
                elements.statusText.textContent = `Selesai memutar ${state.currentSurah.name}`;
                stopPlayback();
            }
        }

        function pausePlayback() {
            if (state.synthesis) {
                state.synthesis.pause();
            }
            state.isPaused = true;
            updateControls();
            elements.statusText.textContent = "Dijeda";
        }

        function resumePlayback() {
            if (state.synthesis) {
                state.synthesis.resume();
            }
            state.isPaused = false;
            updateControls();
            elements.statusText.textContent = `Melanjutkan ayat ${state.currentVerseIndex + 1}`;
        }

        function stopPlayback() {
            if (state.synthesis) {
                state.synthesis.cancel();
            }
            
            state.isPlaying = false;
            state.isPaused = false;
            updateControls();
            
            // Reset UI
            document.querySelectorAll('.verse').forEach(verse => {
                verse.classList.remove('active', 'playing-translation');
            });
            
            elements.statusText.textContent = "Playback dihentikan";
        }

        function resetPlayback() {
            stopPlayback();
            state.currentVerseIndex = 0;
        }

        function updateVerseHighlight() {
            document.querySelectorAll('.verse').forEach(verse => {
                verse.classList.remove('active');
            });
            
            const currentVerse = document.getElementById(`verse-${state.currentVerseIndex}`);
            if (currentVerse) {
                currentVerse.classList.add('active');
            }
        }

        function updateControls() {
            const hasSurah = !!state.currentSurah;
            
            elements.playBtn.disabled = !hasSurah || (state.isPlaying && !state.isPaused);
            elements.pauseBtn.disabled = !hasSurah || !state.isPlaying || state.isPaused;
            elements.stopBtn.disabled = !hasSurah || !state.isPlaying;
            
            elements.playBtn.textContent = state.isPaused ? "▶ Lanjutkan" : "▶ Mulai Auto-Play";
        }

        // Auto-load surah pertama
        window.addEventListener('load', () => {
            loadSurah();
        });
    </script>
</body>
</html>